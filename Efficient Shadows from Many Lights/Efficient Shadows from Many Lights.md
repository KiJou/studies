---
title: Efficient Shadows from Many Lights [@Olsson2015b]
---
# SIGGRAPH 2015

# Efficient Shadows from Many Lights

# 概要

- 問題定義
- 動的シーン
    - シャドウマップ
- 静的シーンの要素
    - 他の手法(も)

# 何が問題？

- "多数のライトに対するシャドウ"
    - 多種多様なことを意味し得る！
    - それぞれに多数の解法がある

# 何が問題？

- 我々の問題ではない:
    - 非常に小さい多数のライト
        - シャドウを必要としない
<!--  -->
- 例:
    - Photon Splatting [@Sturzlinger97; @Dachsbacher06]
        - オクルージョンがすでに計算されている

# 何が問題？

- 我々の問題ではない:
    - 非常に小さい多数のライト
        - シャドウを必要としない
    - 多くの重なりを持つ大きなライト
        - 可視性を近似できる
<!--  -->
- 例:
    - Imperfect Shadow Maps [@Ritschel08]
    - ManyLoDs [@Hollander11]

# 何が問題？

- 我々の問題: その中間
    - 現在/未来のゲーム
    - 動的なライトおよびシーン
    - 数百個の全方向性[omnidirectional]ライト
        - ビューあたりわずか数十個のライトがサンプルされる
    - 高品質なシャドウ
        - 誤差の"平均化[average out]"を行わない
    - リアルタイム
        - 少なくとも"研究的実時間[research real time]"である

# UKD Necropolis

- 約300〜400個のライト
    - 大きさが変化する
- 2.6Mのトライアングル
- 最小でだいたい30FPS
- Geforce Titan

# シャドウ品質

# 完全に動的なシーン

# いったいどうしてシャドウマップなのか？

- デファクトスタンダード
    - 猫も杓子も[despite everything]…
- シャドウが高い一貫性を持つ
- ハードウェア/APIにおける柔軟性が増す
- スケーリングが他のテクニックほど酷くない
- キューブシャドウマップが利用可能
- レイトレーシング/シャドウボリューム/など？
    - 動的でない
    - 遅すぎる
    - フィルタ不可能

# 解法の内訳[breakdown]

1. どのライトがシャドウをキャストするか？
2. シャドウマップごとに必要な解像度は？
3. シャドウマップのメモリを管理する
4. シャドウをキャストするジオメトリをカリングする
5. シャドウマップを描画する
6. シーンをシェーディングする

# 多数のライトに対するシャドウ

- I3D 2014とTVCG 2015による論文
    - "(More) Efficient Virtual Shadow Maps for Many Lights"
- Clustered Shadingの上に構築する
- シャドウのサポートを追加する
    - 何百個、リアルタイム
        - もちろん、少なくとも研究的実時間
    - 高く一貫性のある品質
    - 効率的なカリング
    - Virtual/Sparseテクスチャのユースケース

# 解法の内訳

1. **どのライトがシャドウをキャストするか？**
2. シャドウマップごとに必要な解像度は？
3. シャドウマップのメモリを管理する
4. シャドウをキャストするジオメトリをカリングする
5. シャドウマップを描画する
6. シーンをシェーディングする

# Clustered Shadingの重要な特徴

- クラスタ
    - 可視ジオメトリに対するプロキシ
        - ビューサンプルの境界となる
            - 3Dボックス
        - 数回り小さい[orders of magnitudes fewer]
    - クラスタ/ライトのペア
        - クラスタとライトを接続する

# Clustered Shadingの重要な特徴

- クラスタ
    - 可視ジオメトリに対するプロキシ
        - ビューサンプルの境界となる
            - 3Dボックス
        - 数回り小さい
    - クラスタ/ライトのペア
        - クラスタとライトを接続する

# 解法の内訳

1. **どのライトがシャドウをキャストするか？**
2. シャドウマップごとに必要な解像度は？
3. シャドウマップのメモリを管理する
4. シャドウをキャストするジオメトリをカリングする
5. シャドウマップを描画する
6. シーンをシェーディングする

# 解法の内訳

1. どのライトがシャドウをキャストするか？
2. **シャドウマップごとに必要な解像度は？**
3. シャドウマップのメモリを管理する
4. シャドウをキャストするジオメトリをカリングする
5. シャドウマップを描画する
6. シーンをシェーディングする

# シャドウマップの解像度

- 一定の解像度を選び出す
    - アンダーおよびオーバーサンプリング
    - 不十分な品質

# シャドウマップの解像度

- 一定の解像度を選び出す
    - アンダーおよびオーバーサンプリング
    - 不十分な品質
- サンプル密度に対応させる
    - スクリーン空間
    - シャドウマップ空間

# 2. シャドウマップの解像度

# シャドウマップの解像度

<!--  -->
- ある一般的なアプローチ(例、[@King04])はライトの境界球の投影から必要なシャドウマップの解像度を推定する。

# シャドウマップの解像度

- より良い推定を行うためにシャドウレシーバーの位置を用いる[@Forsyth04; @Lefohn07]

# シャドウマップの解像度

例えば、ライトへシャドウレシーバーの境界ボックスを投影する[@Forsyth04]

# シャドウマップの解像度

または、個々のサンプルを投影する[@Lefohn07]

# シャドウマップの解像度

# シャドウマップの解像度

各クラスタは固定のスクリーン空間フットプリントを持つ

# シャドウマップの解像度

# シャドウマップの解像度

# シャドウマップの解像度

クラスタはシャドウマップ上にフットプリントを持つ

# シャドウマップの解像度

これは、立体角に比例して必要な解像度を計算できる

# シャドウマップの解像度

# シャドウマップの解像度

より遠方のシャドウマップについて考える。

クラスタはより大きな立体角をなし、それ故に、シャドウマップの解像度は小さくなる。

# 解像度の計算

- ライトの球上の立体角
- すべてのクラスタ/ライトのペアで並列に
    - ライトごとに一番高い値を保持する
        - atomicMax
- $Res = \sqrt{\frac{S/(\alpha/4\pi)}{6}}$
    - $\alpha$ = 立体角
    - $S$ = スクリーン空間フットプリント(例、32x32)

# 解法の内訳

1. どのライトがシャドウをキャストするか？
2. **シャドウマップごとに必要な解像度は？**
3. シャドウマップのメモリを管理する
4. シャドウをキャストするジオメトリをカリングする
5. シャドウマップを描画する
6. シーンをシェーディングする

# 解法の内訳

1. どのライトがシャドウをキャストするか？
2. シャドウマップごとに必要な解像度は？
3. **シャドウマップのメモリを管理する**
4. シャドウをキャストするジオメトリをカリングする
5. シャドウマップを描画する
6. シーンをシェーディングする

# シャドウマップのストレージ

TODO

---
title: >
    A Certain Slant of Light: Past, Present and Future Challenges of Global Illumination in Games [@Barre-Brisebois2017]
---
# A Certain Slant of Light: Past, Present and Future Challenges of Global Illumination in Games

# 自己紹介

# アジェンダ

- この分野の現状
- 現在の課題
- 今後のこと
- 質疑応答

# あなたのために何が入っているか？

以下のことに関して知りたいので…

- 研究者向け
    - 学術研究[academia]におけるGIをゲームにおける**最新技術**と比較する方法
    - ゲームにおける最新のアート、エンジニアリング、パイプライン、**プロダクション上の課題**
    - アーティストおよびプログラマが現在のアプローチを持っている**根本的な問題**
    - ゲーム業界における**未解決のGI問題**、および、**将来の研究を適応させる**方法
- ゲーム開発者向け
    - あなたの分野における**GIの現状**！
    - 学術研究を目標達成のために**役立てる**方法
    - **共同研究の機会[collaboration opportunities]**を改善&生成するためにできること
    - GIが今後のゲームで向かう先

# 始める前に

- 連絡をくれたり、コンテンツを収集するのを手伝ってくれた**全員**に感謝
- 発売済みのゲームでのGIの**最新技術**を**まとめる**ためのベストを尽くした
- あれやこれやを見逃しているみたい？**教えてください**！
- すべての参考文献はトークの終わりに

# 免責 --- ストレージ対データ

***ストレージはフォーマットやエンコーディングから非依存にできる***

しばしば取り合わせは様々となり得る

# ゲームの大域照明(GI)とは？

[@Ritschel2011]

# この分野の現状

# Surface Caching

Quake [@Abrash2000]

- ゲームにおける大域照明の始まり…
- **事前計算済み放射照度[precomputed irradiance]**を格納する最初のゲームのひとつ
- 空間、ボリューム、張り[tension]の感じがより良い
- 頂点かテクセルに影響を与えるすべてのライトに対してひとつの**8ビット**値
- 後に色付けされる(Quake2)

画像は[@Bush2015]から

# Radiosity Normal Mapping

Mirror's Edge [@Halen2009]

- Half-Life2で見られるヤツ [@McTaggart2004]
- **平坦なアンビエントを回避する**
- TS^[訳注:恐らくTangent Spaceのこと]における3つの方向に、3つの完全なRGBのライティング値
- *cos(NormalMap, BasisDirections)*に基づいたブレンディング
- **スペキュラを近似できる**
    - ビューベクトルが基底に並行であるとき
    - 粗いスペキュラだと"OK"、低いラフネスだと駄目
- 多くのゲームやエンジンで使われている！

# Spherical Harmonics Lightmaps

[@Chen2008]
[@Sloan2008]

- "大局的"な改良された忠実性へのもうひとつの一歩
- **オフラインのフォトンマッパー**に由来する球面調和関数
- テクセルは、球面上の連続関数として、表面点[surface point]に放射照度を持つ
- 動的オブジェクトのためのプロブもまたSHとして格納される
- SHは**ディフューズには素晴らしい**が、スペキュラには…

Halo 3

# Spherical Gaussians Lightmaps

The Order: 1886 [@Neubelt2014]
[@Pettineo2016]

- 球面ガウス関数[spherical gaussians]を用いて入射する放射輝度を近似する
- **ディフューズとスペキュラ**に対する直観的かつコンパクトな表現
- 動的オブジェクトのためのプロブもまたSGとして格納される
- 広範囲に渡る実装がMattのブログで詳しく述べられている[@Pettineo2016]

# Heightfield GI

UE4 Kite Demo --- 高さフィールドGIなし(左)とあり(右) [@Seymour2015]
MotoGPにおけるStatic Terrain Radiosity Maps [@Hargreaves2003]

- 高さフィールド上の**広いエリア**や**環境光**用。動的にできる[@Nowrouzezahrai2009]
- MotoGPの事前計算済みラジオシティマップ(2003)以来の多くの改善[@Hargreaves2003; @Oat2007]
- 利点: 高さベースのワールドに対する巧みな解法
- 欠点: 高さフィールドのみ。屋内では機能しない

# Precomputed Form Factors

[@Enlighten]

- 有限要素にシーンを**分割[subdivide]**する
- 要素間の可視性を**事前計算**する
- *大量の動的ライト*に対する、ディフューズGIに対する実行時に使われるtransfer関数
- ライトマップやプロブに格納される
- ジオメトリ(可視性)が変化すると再計算しなければならない

# Probe-only* Approaches

Tom Clancy's The Division [@Stefanov2015]
Quantum Break [@Silvennoinen2015]

- プロブにおける**PRT**(FarcryやDivision)、**放射照度ボリューム**([@Tatarchuk2005]やQuantum Break)
- 様々に統一化された[various unified]CPUまたはGPUのコンソールで使いやすい[console friendly]大域照明の近似
    - *FarCry4*: GPUページテーブルへのプロブセルのストリーミング(radiance tranfer、clipmap injection and sampling) [@McAuley2015]
    - *The Division*: surfels-to-probe、surfel共有付き (Gバッファのキューブマップ) [@Stefanov2015]
    - *Quantum Break*: 八分木を介する適応的放射照度ボリューム[@Silvennoinen2015]
- \*ライトマップとの組み合わせで用いることもできる。後に、ライティングと可視性を分ける[@Iwanicki2017]
- 利点: 同じデータで動的および静的オブジェクトが照らされる。*ボリューメトリック*！
- 欠点: 間接スペキュラの品質が高くない。ので、スペキュラはIBLやSSRから

# Virtual Point Lights

Gears of War 3 [@Malmros2017]
The Last of Us

- **Reflective Shadow Maps**(RSMs)から**Virtual Point Lights**(VPLs)を生成する[@Dachsbacher2004]
- プレイヤーのフラッシュライト用だが、他のスポットライト用にも
- 利点: バウンスを近似する安価なポイントライト。かなり説得力を強くできる！
- 欠点: 不安定になり得る(VPLの選択)。局所化された解法。精度が気になるかも。

# Light Propagation Volumes

FableにおけるCascaded Light Propagation Volumes [@Woodhouse2014]
Clipmap
CrytekのLight Propagation Volumes [@Kaplanyan2009]

- RSMsにシーンをレンダリングして、ボリュームにVPLsを**注入**して、**伝播**して、**適用**する[@Kaplanyan2009]
- **clipmap**でカスケードする: 近くが細かくなり、距離に一致する[consistent]
- 利点: **事前処理なし**。コンソールハードウェアで使いやすく、**ボリューメトリック**！
- 欠点: グリッドの不整合[misalignment]がbleedingを引き起こし得る。VPLエイリアシングに起因する安定性の問題

# Voxel Cone Tracing

Sparse Voxel Octree Cone Tracing [@Crassin2011]
The Tomorrow Children's Cascaded Voxel Cone Tracing [@McLaren2015]

- 元々のアイデアは[@Crassin2011]に由来、**Sparse Voxel Tree**を用いる
- **clipmap**を使う[@McLaren2014; @Pantaleev2015]、八分木と比べてよりGPUフレンドリー[@Mittring2012]
- 利点: **ディフューズ**および**スペキュラ**のGI、ボクセルによる**中から大縮尺のAO**[@Crytek2016]
- 欠点: いくらかのGIのリーク、低ラフネスのスペキュラコーンのコストが重大、clipmapの遷移

# Ambient Occlusion?

- 複数の頻度
    - **近距離場[near-field]**: 頂点やライトマップ、空洞[cavity]、スクリーンスペース(SSAO) [@Mittring2007]
    - **中距離場[mid-field]**: 頂点やライトマップ、SSAO、ボリューム、カプセル [@Hill2010]
    - **遠距離場[far-field]**: [@Sloan2016]、高さベース[@McAuley2015]、距離フィールド(UE4) [@Wright2015]

GPU上でベイクするAmbient Obscurance [@Sloan2016]
SH Sky Occlusion [@McAuley2015]
AO Fields and AO Capsules [@Hill2010]

# Screen Space GI?

SSDO [@Ritschel2009]
Quantum Break [@Silvennoinen2015]

- スクリーンスペースを介する追加の近距離場の局所的なディフューズGI
    - Screen-Space Diffuse Lighting [@Silvennoinen2015]
    - SSDOに由来する第1バウンス近似に触発される[@Ritschel2009]

# Specular GI?

Stochastic SSR [@Stachowiak2014]
Cubemap Relighting [@McAuley2015]
Box Projected Cube Maps [@Bech2010]

- 以下を介して大抵は近似される
    - Parallax-Corrected Cubemaps [@Bech2010; @Lagarde2012]
    - Screen-Space Reflections (SSR) [@Sousa2011; @Stachowiak2014]
    - Cubemap relighting [@Stachowiak2014; @McAuley2015]
    - 2次のSHから支配的な色[dominant color]を抽出する
    - SGに対するスペキュラ[@Neubelt2014]
- ほとんどのゲームはスペキュラ光輸送のためのスペキュラを行わない

# アート、エンジニアリング、パイプライン、プロダクション上の課題

# 見た目の的一貫性

- 光輸送の見た目にもっともらしい表現(8年前)
    - color bleeding、大局的シャドウ、色付きの半透明物
    - 見た目の一貫性を最大化するためのアートディレクションと技術の賢い組み合わせ

# 見た目の一貫性が損なわれるとき

- その処理における見た目の一貫性を破壊し得る様々な点
    - **単純化された表現 ≠ 見た目の表現**
        - 手製のメッシュプロキシ[@Martin2010]
    - GIに対する**PBRパラメータの過剰に単純化された表現**
        - 単純化されたアルベド色
        - 金属質の表面を扱わない
        - 適切にラフネスを扱わない
        - ビュー依存の結果を再構築するために十分な計算後情報を格納しない
    - **解像度**問題
        - 頂点/表面/詳細の法線とテクセル/ボクセル/プロブの比
    - GIや独自のフィルタ(Gobo/Gel/Cookie)に対して**シャドウをキャストするライトを適切に扱わない**
    - オブジェクト毎/ライト毎の**独自のパラメータ**
    - **ライティングのチャネル**や**負のライト**…

# イテレーションが失敗するとき

- ゲームワールド全体を再計算する必要がある長い事前計算は大きな問題である！
    - 開発中では**ライティングは常に"間違っている"**
    - **イテレーション**を破壊し、レビューや承認プロセスにおける**深刻な依存性**を作る可能性があり、**完全にレビューを台無しにする**
        - すなわち、ビルドはライティングが"生成"される前に2つのリビジョンを作る、アートを判断し辛い！
        - すなわち、ライティングは、承認後に、レベル作成プロセスで後に行われる
    - "グローバル" = 柱をひとつ移動すると、近い所だけではなくレベル全体を再ライティングしなければならない
    - コンピュータが使えなくなる5分以上かかるプレビューモード
- シナリオの例: オープンワールドマップに対するGIのナイトリービルド(8時間以上)
    1. アーティストは自動的に始まる処理に間に合うようにすべてを提出する
    2. 毎夜に処理を実行する
    3. アーティストは朝に仕事に着き、同期して、エディタを開いて、見た目が壊れているものを見つける
    4. 直して、提出して、待つ(次の日、または、数時間)
    5. 洗い流してもう一度
- このような処理は非常に静的なゲームワールドを引き起こす

# オーサリングが失敗するとき

- 堅牢性不足を補うために手動の調整に頼る
    - 説得力のある伝播が不足しているときのための**GIのみのライト**
    - **オブジェクト毎のGIパラメータ**、オブジェクトを人工的に"pop"するように手動で調整される
    - **ボリュームや平面をオーバーライド**してリークを直す(屋内/屋外)
    - GIを取り除くための**負のライト**
- 単純作業[grunt work]: 以下の作業が好きなアーティストはこの世にはいないと思う
    - ライトマップUVのアンラッピング
    - GI用の単純化されたジオメトリの構築
    - 大丈夫とは言ったものの当日中にさばききれないようなその他のいずれかの作業をアーティストに負担させる^[誤訳？]

# nミリ秒以下のしきい値

- 技術をゲームにできるまでのゲームやプラットフォーム固有の締切
    - 我々は我々のframesをかなり忙しくし続ける傾向にある
    - **審美眼**の大幅な変更が無い限り、それ以外はそのままにしなければならないだろう
    - プロダクションの**初期**に実装しなければならない
- 30Hzのゲーム: [0-10%] [0...3.0ms]
- 60Hzのゲーム: [0-10%] [0...1.5ms]
- コマ落ちしない60Hzの競争力の高いゲームやVR:
    - 16ms @ 60Hz ... だが、本当はそれより少ない
    - MK / Injustice: 12-13msのフレーム時間[@Greenberg2005]、FIFA
- 非ハイエンドGPUを考慮する(TFLOPS) [@Wikipedia]
    - PS4:1.8、PS4Pro:4.2、XB1:1.3、XB1X:6
    - TitanX:11、Vega:13.1

# 電力コスト(\$)

- モダンな大きいワールドに対する(一部/全部の)ライティングの事前計算のための電力コストは非自明であるかもしれない
    - **たくましい[beefy]マシン**/サーバーのセットアップ
    - Halo 3: 256つのサーバ、456つのプロセサ、1GBのメモリ[@Chen2008; @Villegas2008]
    - CoD: 48GBのRAMと12GBのVRAMのマシン[@Hooker2016]
    - Destiny: AOをベイクするための数十のサーバを持つファーム[@Sloan2016]
    - SNDBS/Incredibuild: 毎夜に動作するGPUのプール(650W超のPSUs)
    - **追加コスト**を考慮する(つまり、冷却、ハードウェアの故障、…)
- 長時間の実行では**クラウド計算はより安価になるかも**
    - 電気のコストを減らすことでも(業務用vs家庭用)

# オープンワールドの厄介者[beast]

- オープンワールドゲーム用GIソリューションは非自明である
    - **尺度**を扱う
        - 大規模なワールドの大きさ、品質の面で
            - ACU: スケーラブルな品質(DVDの容量)、PCではGIに最大21GB超
            - 重大なチームの決定事項であり、その価値があった！
        - 高いエンティティ数
            - Wildlands[@Werle2017]: 839,862つの木、3,449,638つのブッシュ、775,288つの石
    - コンソールのメモリに留め、**ストリーミング**を扱う
    - (リークなしに)**屋内と屋外**を扱う
    - しばしば**時刻変化[time-of-day]**、**天候**を扱う
    - そのような尺度のコンテンツのオーサリングは以下を必要とする
        - **堅牢**で**分散**された処理
        - オーサリング/アップデートしやすく、プロダクション管理ができる

# ゲームの機能

- GIを作る/壊すことができるいくつかの機能
    - **擦り傷[wear]、切り傷[tear]、破壊**
        - 壁の穴は大幅にGIを破壊し得る
        - 任意の可鍛性[かたんせい;malleble]^[破壊せずに変形できる性質]を持つワールドを扱う
    - **時刻変化**
        - アート指示されたキーとなる時間、だが、その間はどうなる？
        - 補間は最良の結果を常にはもたらさない
    - **天候**
    - **ユーザ生成された/組み立てられた環境**
        - 合成やパフォーマンスなどに対して、ここでAAAゲーム開発のアーティストのオーサリングを保証できない
    - **移動するモノ、ライトのオンオフ、ボリューメトリクス**

# 今後のこと

# 今後のゲームのためのGI

手製
プロシージャル
プレイヤー生成

# 一級市民としてのGI

- アーティストはゲームプレイに対してシャドウを当てにするが、GIは当てにしない
- **銃撃戦[firefight]が燃えているものを実際にセットしているFPS**
    - 連続して燃えている、ライティングやGIに影響を与える
    - 偶発的な火からのライティングはゲームプレイ上で大きく印象的な効果を持つ可能性がある
- **他のプレイヤーが角を曲がった先にいるcorridor shooter**
    - 彼らのマズルフラッシュのバウンスが見える
    - 音声が先にあるものの手がかりをもたらす。つまり、GIで可能
- より良いゲームや体験を創造するためにGIを使う

# 混合環境

***異なるジオメトリに対する矛盾した表現***

- 有機的: 森/草木のためのGIは非自明である
    - 幹[trunk]/大きな枝[branches]: ライトマップ？(たぶん…)
    - 枝[branches]: プロブ？頂点色？
    - 葉(cards): ...
- 有機的、および、人工的に作られた環境に対する統一された解法を必要とする
    - 同じ環境に共存する
    - hard edges
    - リークさせたくない

# 関与媒質

***複合的な関与媒質に対するGIはゲームにおいてまったくもって未解決である***

物理ベースの火砕[pyroclastic]シミュレーションでワールドをライティングする！

# スペキュラGIの重要性

SVOGIを用いた間接スペキュラ [@Crassin2012]

# プレイヤー生成コンテンツ

***ユーザー生成コンテンツからはAAAゲーム開発のアートや合成を前提とすることができない***

- プレイヤーが作ったワールドの(恐らく)変な組み立てを調停する[reconcile]
    - プレイヤーは自身がやりたいことやシステムが対応することなら何でも行う可能性がある
    - **変な比率**(ジオメトリ/マテリアル)や**変な合成**を扱う
    - オフライン処理なしに
- 真のイコライザとしての代替のランタイム表現？
    - ボクセル化？
    - 球状表現？
    - または、一般/一様/コンパクトな表現に変換する
- (何百万の任意のアセットで)just workする堅牢な解法を必要とする

# アーティスト視点

***我々の主要なクライアントを念頭にGIを設計する: アーティストとデザイナー！***

- 全体VS詳細
    - "大局[big picture]"のGIをすばやく解いて、**時間をかけて詳細をリファインする**
- refinementを伴う進行性[progressive]フィードバック
    - **素早いプリビズ**をサポートするアルゴリズム、nフレームに作業を分割できる
    - refinementゾーン(ユーザ、カメラ駆動)は上手く機能する: progressive lightmapper [@Unity2016]
    - (アートレビュー、プレイテスト、バグの)**人々の邪魔をしない**ための最終品質の**ランタイム近似**
    - 劇的に**イテレーション回数を改善する**、イテレーション??品質
    - 中断時間[downtime]を少なくする、ベイクは常に中段時間を意味する

# 単調作業ゼロのパイプラインに向けて

***自動的なパラメータ化と良好なインターフェイス***

- つまらない"アートじゃない"手動の手順を排除しよう
    - ライトマップUVのアンラッピング
    - GI用の単純化されたジオメトリの構築
    - GIや反射ボリュームの手動設置
    - その他自動化できそうな非アーティスティックな手順
- インターフェイスと調整可能なもの
    - すべてを開示することは最良の結果を**意味しない**
        - 酷いPBR: 75%の金属
    - **単純**で**明確**なアーティストとアートディレクターに**使いやすい**パラメータ
        - 極端なものを試してモノをテストする: 0-1マッピング
        - 複雑な振る舞い: 4つのスライダーを操るスライダー。プリセット！

# 今後のライトの種類

***エリアライティングはますます一般的になっている***

- ゲームにおけるいくつかの領域で使われる[@Drobot2013; @Lagarde2014; @Heitz2016]
    - ランタイム(窓、広告看板、ライトを包むもの)
    - インゲームシネマティクス(フォトスタジオのライティング、3つ超のポイントライティング)
- リアルタイムにそのようなライトタイプで動作するGIシステムを構築する必要がある
    - ディフューザ、テクスチャ、アニメーション付きで
    - 直接的なエリアライトのシャドウも未だに残念ながら困難である

# Denoising/再構築

***Denoisingは解法としてパストレーシングを考慮するときに意味を持つ***

An Efficient Denoising Algorithm for Global Illumination [@Mara2017]
Spatiotemporal Variance-Guided Filtering: Real-Time Reconstruction for Path-Traced Global Illumination [@Schied2017]

Morgan@HPG&SIGGRAPH
品質がいくつか損なわれるが、240000倍速くなるなら、そっちを取るだろう。そしたら、その分野は品質をまったく損なわない方法を見出す必要がある。

これらの論文のdenoisersは依然としてこんにちのゲームには重すぎる(TITAN Xで1-2spp、10ms)。だが、映画のdenisersよりは格段に速い。(100+spp、数秒から数分)。大きな進歩だ！

# ディープラーニング

***ディープラーニングは同様にレンダリングに進出している！***

Neural Network Ambient Occlusion [@Holden2016]
Interactive Reconstruction of Monte Carlo Image Sequences using a Recurrent Denising Autoencoder [@AllaChaitanya2017]

ディープラーニングとレンダリングについてのさらなる情報はMarcoのトークで
**"Deep Learning: The Future of Real-Time Rendering?" 午後4時25分から**

# 未解決問題[open questions]

- 完全に統一されたリアルタイムGIソリューションにおける次なる大きな一歩とは？
    - 統一された"すべてのBSDFを解く"アプローチを必要とする(有機物、人工物、ボリューメトリクス)
    - 完全に可鍛的で変形可能で相互作用的なワールドに対して解く必要がある
- エンジンアーキテクチャと現在のアート手法は高品質なリアルタイムGIで前進するのを妨げているか？
    - トライアングルを使わなかったとしたらどうか…
    - GIで使われるデータ表現がオーサリングから完全に異なったとしたらどうか？
    - 将来のレンダリングアーキテクチャとしてのリアルタイムdenoisedパストレーサー？
- モバイルやVRでリアルタイムGIを解くにはどうしたらよいか？
    - 中から遠距離をクラウドで、近距離をデバイスで？

# ゲーム開発者VS研究者

- かなりたくさんの学術的情報源
    - SIGGRAPH/SIGGRAPH ASIA
    - I3D
    - HPG
    - EGSR
    - JCGT
    - GDC
    - WikiCFP

あなたのゲームで上手く機能するものを見つけることは時折見つかる望みのないものを探すように感じるかもしれない

# ゲーム開発者VS研究者

そして、一度見つかれば、我々はエンジン内をduct tapeしなければならないかもしれない

# 綱引き[tug-of-war]

ゲーム開発者
デモやソースが欲しい！
失敗する箇所が知りたい！

研究者
ゲーム関連のアセットが欲しい！
もっと公開資料がほしい！

- 我々は**より素晴らしい利益のために一丸となる**ために個々の組織に**挑む**必要がある
- **ゲーム開発者**:
    - 疑問があるときは研究機関に問い合わせる！
    - かれらと共に仕事をするために様々な方法を探すことを考慮する、そして、いくつかのアセットを共有する！
    - あなたのGDC/SIGGRAPHのプレゼンテーションに研究機関への引用や謝辞を加える！
- **研究者**:
    - ゲーム開発者があなたにコンタクトするとき、彼らはあなたからの返事に興味がありそれが欲しいことを意味している！
    - それは単なる"実装の詳細"ではない。引用[@Hecker2011; @Baker2011]やアーティストの増員[@McGuire2013]に加えて実用性を検討している
    - あなたの技術がゲームに属していると思う？いいね！さらなる情報は次のスライドで
- 中立の場: JCGT

# あなたの技術をゲームに加えるには

- **あなたのものをゲームに入れ込みたいならば、ここに最大限の可視化を達成する方法がある**
    1. 論文にHLSL/GLSL/コードを入れ込む(つまり、appendix)
        - 多くのグラフィクスプログラマは広範囲に渡る数学的背景を持っているが、あなたの方がより完璧である可能性が高い
        - ソースから学ぶ方がより簡単であり、すばやくものを試せることは素晴らしいことである
    2. ソース付きのデモを動かす
        - Github
    3. ソーシャルメディアを使う
        - ツイッター: 多くの開発者がここに入り浸っているし、彼らが見つけた興味深い論文をリツイートしている
        - まとめたり追加のコンテンツを加えたりするためのブログ投稿(つまり、破綻箇所などのまとめ)
    4. 関連するアートのアセット
        - Morgan McGuireのメッシュデータベースをチェックする[@McGuire2017b]
        - 違うなにかが欲しい？アートフォーラムのアーティストに尋ねてみよう！
    5. *ms*ではなく*fps*を使う[@Hecker2011; @Baker2011]
    6. ハイエンドでないGPUで試す ;) (スライド26)
    7. **我々や他のR&Dグループと協力しよう！**

# まとめ

- まだやるべきことは沢山ある！
    - 将来のゲームのための統一されたGIソリューションに向けて動いてゆく必要がある
    - 研究者とゲーム開発者との間のさらに多くの/強力なコラボレーションを必要とする、両者が勝利するようなモデルで！
    - 研究とゲーム開発の両方のGIの最新の進歩をもってすれば、将来は安泰そうだな！

# スペシャルサンクス

# 参考文献(1/2)

# 参考文献(2/2)

# ご質問は？

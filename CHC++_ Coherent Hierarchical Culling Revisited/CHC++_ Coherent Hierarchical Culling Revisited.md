---
title: >
CHC++: Coherent Hierarchical Culling Revisited [@Mattausch2008]
#bibliography: bibliography.bib
---
# はじめに {#sec:1}

オクルージョンクエリは複合的なシーンをレンダリングするのにかかる時間を減らすために重要な技術である。いわゆるハードウェアオクルージョンクエリの可用性は可視性の実行時測定[runtime determination]を魅力的にしてきた。ハードウェアオクルージョンクエリはグラフィクスハードウェアが単純なプロキシオブジェクトの可視性状態を素早く報告できるメカニズムである。しかしながら、ハードウェアオクルージョンクエリが使用できるようになるのは、例えばCoherent Hierarchical Culling(CHC)アルゴリズム[@BWPP04]にあるような、時間的一貫性[temporal coherence]を活用することによってのみである。なぜなら、これはCPUをストールしたりGPUを飢餓状態[starvation]にしたりすること回避するためである。

CHCアルゴリズムは密に遮蔽された[densely occluded]シーンで上手く機能するが、ハードウェアオクルージョンクエリのオーバーヘッドはいくつかの状況において単純な視錐台カリング(VFC)にさえ後れを取る[fall behind]ようにしてしまう。これは、オクルージョンの賢い統計モデルとハードウェア校正[calibration]ステップに基づいてクエリ数を減少させるNear Optimal Hierarchical Culling(NOHC)と呼ばれるアルゴリズムを提供する、Guthe et al.[@GBK06]によって認知された。しかしながら、Guthe et al.によって定義された最適条件でさえ更なる単純化の源を活用することによって依然として改善できる。

![視錐台カリング(VFC)、Coherent Hierarchical Culling (CHC)、Near Optimal Hierarchical Culling (NOHC)、我々の新しいアルゴリズム(CHC++)に対する発電所モデルのウォークスルーのフレーム時間の比較。](){#fig:1}

本論において、我々は以前のオンラインなオクルージョンカリング手法に大幅な改良を加える手法であるCHC++を提案する([@fig:1]を参照)。そのアルゴリズムの核は単純なままであり、校正をまったく必要とせず、ゲームエンジンへと簡単に統合することができる。その手法の主要な貢献は以下である。

- **状態変化[state changes]の削減**。その重要性に関わらず、状態変化の削減は以前のオクルージョンカリング手法によって明示的に扱われなかった。我々の手法はクエリのバッチ処理を用いることによって状態変化の数を最小化するための強力なメカニズムを提供する。結果として、状態変化の総数は1桁以上[more than an order of magnitude]削減される。
- **クエリ数の削減**。クエリ数の削減はハードウェアベースのオクルージョンカリングにおける以前の研究の主要な目標であった。例えば、Guthe et al.[@GBK06]によって提案されるNOHCアルゴリズムは低い遮蔽率を持つビューに対するクエリ数の削減では非常に成功している。我々はクエリ数の更なる削減のための2つの新しい手法を提案する。1つ目の手法は単一のクエリによって階層において多くのノードの可視性を解決し、2つ目の手法はOriented Bounding Boxやk-DOPのような補助データ構造を必要としないクエリに対するよりタイトな境界ボリュームを活用する。結果として、我々はGuthe et al.[@GBK06]によって定義される"最適"なアルゴリズムより大幅に少ないクエリ数を達成する([@fig:2]を参照)。
- **CPUストールの削減**。CHCアルゴリズムはCPUストールの削減では良い仕事を行っているが、あるシナリオにおいて、ストールは依然として発生し、パフォーマンス上のペナルティを引き起こす。我々は待ち時間のさらなる削減をもたらし、それと同時に状態変化の削減に対する我々の手法と上手く統合する単純な修正を提案する。
- **レンダリングされるジオメトリの削減**。よりタイトな境界ボリュームは境界ボリュームによって引き起こされる可視性の過剰推定を削減し、それ故に、可視として分類されるジオメトリ量を削減するだろう。
- **ゲームエンジンとの統合**。ほとんどのゲームエンジンはマテリアルによってソートされている高度に最適化されたレンダリングループを組み入れ[incorporate]、シェーダはレンダリングステートの変更を最小化する順番で処理される。我々の手法はレンダリングエンジンがレンダキューに格納されるプリミティブのバッチ上でそのようなソートを処理できるようにする。加えて、提案される技術はエンジン呼び出し数を大幅に削減する。

![左上:街のシーンにおけるサンプル視点。右上:CHCアルゴリズムによって必要とされる状態変化(状態変化の数 = 階層ノードの異なる色の数)。左下:CHC++アルゴリズムによって必要とされる状態変化。右下:マルチクエリ:すべての可視ノードがたった2つのオクルージョンクエリによって網羅される(異なる色で示される)。](){#fig:2}

# 関連研究 {#sec:2}

TODO

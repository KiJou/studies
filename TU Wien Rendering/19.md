# #19 --- Space Partitioning 1

## 空間分割(Space Partitioning)

レンダリングでは、3Dシーンに対して光のシミュレーションを行い、オブジェクトとの相互作用を計算することで2Dイメージを生成し、ディスプレイに表示することが必要になる。
フォトリアルな(photorealistic)画を得るためには、膨大な数の光線に対する計算を行わなければならない。そのため、光線の計算コストを少しでも削減できれば、それは全体のパフォーマンスにじかに効いてくる。

レイとオブジェクトの交差判定とは、シーン中で最近傍の交差点を計算することである。言い換えれば、局所的な可視判定(local visibility)である。

単純な(naive)な実装として、すべての三角形と交差判定を行うことが考えられるが、これはシーンが複雑になればなるほど計算量が倍々に増加してゆく。
よりよい方法として、空間を階層(hierarchy)化することで、判定が不要な領域を早期に除外する考え方[^spacial_hierarchy]を導入する。

[^spacial_hierarchy]: 上位の領域が交差しなければ、その下位の領域のいずれも交差しないよう階層構造を定義する。すると、上位の交差判定が失敗すれば、必ず下位の交差判定が失敗するため、計算を省略できる。

### kd木(k-d tree)

kd木は、対象とする空間を軸に垂直な平面により2つに分割することを繰り返して定義した領域にオブジェクトを格納する方法で、CPUによる計算を行うときに有効である。
階層は二分木を構成するため、二分探索による高速な探索が可能である。
しかし、オブジェクトの存在しない空間のノードも保持しなければならないため、ノードの総数は多くなる場合がある。また、オブジェクトが分割面をまたぐ場合は、その両方に重複して格納しなければならない。

### BVH(Bounding Volume Hierarchy)

BVHは、境界領域を階層的に定義する方法で、GPUによる計算を行うときに有効である。
それぞれが独立した境界領域を持つため、動的な変更が比較的容易であり、オブジェクトが重複してノードに格納されることはない。
しかし、境界領域を単純な形状で近似するため、その領域が重なり合うと効率が悪くなる場合がある。

## 用語

フォトリアル(Photoreal)
: 写真のように現実感のある様。

境界領域(Bounding volume)
: オブジェクトが存在する領域を定義するもの。
  立方体や球のようなプリミティブな形状でオブジェクトを包むようなイメージ。

## 英語表現

- integrand
  - [名] 被積分関数

---
title: CRYENGINE3 Graphics Gems [@Sousa2013]
bibliography: bibliography.bib
numberSections: false
---
# アンチエイリアシング \\ ディファードMSAAのレビュー[ANTIALIASING \\ DEFERRED MSAA REVIEW]

- 問題: マルチパス＋マルチサンプルRTからの読み書き
    - DX10.1で`SV_SampleIndex`と`SV_Coverage`が導入された。
    - ピクセル/サンプル頻度パスに対してマルチパス経由で解決できる[@Thibieroz2011]。
- `SV_SampleIndex`
    - サブサンプル *ごとに* ピクセルシェーダ実行を強制して、現時点で実行されたサブサンプルのインデックスを提供する。
    - インデックスはマルチサンプルRTからサブサンプルをフェッチするのに使える。例:`FooMS.Load(UnnormScreenCoord, nSampleIndex)`
- `SV_Coverage`
    - ラスタステージ中にどのサブサンプルがカバーしていたかをピクセルシェーダに示す。
    - カスタムカバレッジマスクでサブサンプルのカバレッジを修正できる。
- DX11.0のコンピュートタイルベースディファードシェーディング/ライティングのMSAAはより単純になる。
    - サブサンプルでタグ付けされたMSAAを通したループ[Loop through MSAA tagged sub-samples]

# ディファードMSAA \\ 用心せよ！[DEFERRED MSAA \\ HEADS UP!]

- 単純な理論、面倒な実践
    - 少なくとも複雑なディファードレンダラを伴う
- 非MSAAフレンドリーなコードは高速に蓄積する。
    - MSAAを考慮しないで新しいテクニックが加わったため、定期的に崩れる。
    - まだイケるとしても…これらはビジュアルアーティファクトを引き起こすので、頻繁に非MSAAフレンドリーなテクニックを特定して修正する必要があるだろう。
    - 例えば、白/黒のアウトライン、または、AAまったくなし。
- 前もって行おう。ディファードMSAAをサポートするためのレンダラを改良することは[some work]である。
    - そして、とても[finiky]である。

# ディファードMSAA \\ カスタム解決＆サンプル毎マスク[DEFERRED MSAA \\ CUSTOM RESOLVE & PER-SAMPLE MASK]

- Gバッファの後にはカスタムMSAA解決を処理する。
    - ライティング/他のMSAA依存パスのようなピクセル頻度パスに対して、サンプル0を事前解決する。
    - 同じパスで、サブサンプルマスクを生成する(サンプルの類似性を比較し、不一致ならばマークする)。
        - MSAAを必要としない領域を無駄に処理してしまうことになるので、デフォルトの`SV_Coverage`を避ける。

# ディファードMSAA \\ ステンシルバッチング[DEFERRED MSAA \\ STENCIL BATCHING [@Sousa2013]]

- 通常のステンシルバッファの使い方でサンプル毎ステンシルマスクをバッチ処理する。
    - ステンシルバッファから1ビットを予約する。
    - サブサンプルマスクで更新する。
    - 単一のピクセルだけではなくピクセルクアッド[pixel-quad]全体をタグ付けする。→ステンシルカリング効率が改善する。
    - サンプル毎ビットのオーバーライドを避けるためにステンシル読み/書きビットマスクを使う。
        - `StencilWriteMask = 0x7f`
    - ステンシルクリアが起こるたび復元する。
- 極端にステンシルを使うため可能ではない？
    - clip/discardを使う。
    - サンプル毎マスクに対する追加のテクスチャ読み込みからの余分なオーバーヘッドもある。

# ディファードMSAA \\ ピクセルおよびサンプル頻度パス[DEFERRED MSAA \\ PIXEL AND SAMPLE FREQUENCY PASSES]

- ピクセル頻度パス
    - *ピクセル毎* 領域に対する予約済みビットにステンシル読み込みマスクをセットする(`~0x80`)。
    - 解決前(非マルチサンプル)ターゲットSRVをバインドする。
    - 普段通りのレンダパス
- サンプル頻度パス
    - *サンプル毎* 領域に対する予約済みビットにステンシル読み込みマスクをセットする(`0x80`)。
    - マルチサンプルターゲットSRVをバインドする。
    - `SV_SampleIndex`経由で現在のサンプルをインデックス付けする。
    - 普段通りのレンダパス

# ディファードMSAA \\ アルファテストSSAA[DEFERRED MSAA \\ ALPHA TEST SSAA]

TODO

# 参考文献[References]

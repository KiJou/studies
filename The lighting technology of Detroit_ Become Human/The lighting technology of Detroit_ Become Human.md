---
title: >
    The lighting technology of Detroit: Become Human [@Caurant2018]
---
# The lighting technology of Detroit: Become Human

# お品書き

- Quantic DreamでのPBRへの道のり
    - Heavy RainからDetroit: Become Humanへ
    - 測光[photometric]の単位
    - マテリアルの較正
- 直接ライティング
    - 解析的なライト
    - シャドウ
    - ボリューメトリックライティング
- 間接ライティング

# Quantic DreamでのPBR

- Heavy Rain (PS3)
    - フォワードシェーディング
    - ガンマ空間
    - Blinn-PhongスペキュラBRDF

# Quantic DreamでのPBR

- Beyond: Two Souls (PS3)
    - ディファードシェーディング
    - ガンマ空間のマテリアル
    - 線形空間のライティング
    - マイクロファセットBRDF近似
        - Litシェーダ: 一定の可視性項付き正規化済みBlinn-Phong
        - Skinシェーダ: 独自の可視性項付きBeckmann分布

# Quantic DreamでのPBR

- Detroit: Become Human (PS4)
    - Clustered Forward Shading
    - 完全な線形空間
    - マイクロファセットスペキュラBRDF (GGX)
    - まだランバートディフューズ($k/\pi$)を使っている
    - 部分的なエネルギー保存
    - ライトとemissiveマテリアルに対する測光単位

# Quantic DreamでのPBR

- マテリアル計算
    - Shading Tree
    - lit、unlit、ランバート、ガラス、肌、髪、目、歯、車の塗装、服[cloth]
    - 強力だが一貫性[coherency]を制御し辛い
    - いくつかのマテリアルは複数のスペキュラローブを持ち得る。

# Quantic DreamでのPBR

- BRDF積層[layer stack]
    - BRDFを複数の層に分割して積み上げる
    - 最大2つのスペキュラローブ＋1つのディフューズ＋1つの表面下または後方散乱[subsurface/backscatter]
    - Litシェーダは1つのスペキュラGGX層を用いる
        - 雨用の金属質表面での追加[optional]の層

[@LAN14]

# Quantic DreamでのPBR

- BRDF層間のエネルギー保存
    - 各"層"は反射するエネルギーと透過するエネルギーを計算する
    - 残りのエネルギーは次の層を計算するのに再利用される
    - BRDF全体でのエネルギーの伝達[transfer]を事前計算する必要がある
        - 複数散乱[multi-scattering]、Fresnel界面
    - 残念ながら、我々はF0を計算に入れるだけである

# Quantic DreamでのPBR

- プロダクションサイクル中に直面する問題:
    - シーン間の不十分[poor]なライティングの一貫性
    - マテリアルの一貫性もまた問題である
    - 異なるシーンで小道具[props]を再利用し辛い
    - => 我々は測光単位に移行することを決断した

# 測光単位

- ライティングの一貫性は我々の主な目標であった
    - 現実[real life]のリファレンスと比較するのがより簡単
    - アーティストは現実の入力値を用いることができる
    - 彼らがアルベドにライティング情報を焼き込めないようにする
    - より良いシーンのコントラストやレンジを可能にする
    - [@LAG14] *"Moving Frostbite to Physically based rendering"*

# 測光単位

- 光量[luminous power]^[光束[luminous flux]とも] ($lm$;ルーメン)
    - 放射される光の総量
- 光度[luminous intensity] ($cd$;カンデラ)
    - ある方向への立体角あたりのルーメン
- 照度[illuminance] ($lux$;ルクス)
    - 表面に降り注ぐ光の量
- 輝度[luminance] ($cd/m^2$;カンデラ毎平方メートル)
    - ある方向における単位面積あたりのカンデラ

# 測光単位

- 直接光はルクスで
- 他のライトはルーメンで
- 必須[mandatory]の二次減衰[quadratic attenuation]
- 照度は大きさを持たない光源[punctual light]の近くで\*非常に\*高い

# 測光単位

- emissiveな表面
    - すべてのマテリアルにあるEmissive Intensityというパラメータ(と色)
    - EV値[Exposure Value]で表現される
        - $cd/m^2$は線形な尺度だが、人間の目ではそのように知覚されない
        - EV値は知覚的に線形である
        - EV値を+1すると、知覚される光度は倍になる

# 測光単位 --- 露出

- シーンの露出
    - レベルエディタでシーンを正確に露出する必要がある
        - 自動露出は推奨されない
        - 典型的なライティング条件に対する計測された露出を使う
    - 我々のレベルは"Scene Zone"(SZ)に分割される
    - 撮影[photography]のディレクターは"SZ"ごとに露出を規定[provide]する
    - 値を固定し、使い回さない[no transitions]
    - カメラが"SZ"に侵入するときに露出を適用する

# 測光単位 --- 露出

- シーンの露出
    - 露出はEV100で表される
        - カメラのシャッタースピードとF値の組み合わせを表現する
        - EV100はISO100のセンサ感度に対するEV値である
    - 一貫性のあるライティングレンジを保証するためのフレームワークをもたらす
    - シーンの露出は**露出前**の累積バッファにとってとても良いものである
    - インゲーム露出にはさらなる制御が必要である

# 測光単位 --- 露出

- カメラの露出
    - シーン露出の上の**露出補正[exposure compensation]**
    - 露出を動的に変化させるための制御をもたらす
    - アーティストは4つの露出タイプから選択できる
    - 自動露出 = ゲームプレイのフェーズ(主に)
    - 手動露出 = カットシーン(主に)

# 測光単位 --- 露出

- カメラ露出の種類:
    - 手動
        - EV100におけるEV値、[animated curves]で制御できる
    - カメラ
        - 物理的なカメラ設定(F値、ISO、シャッター時間)から計算される
    - 自動・平均
        - シーンの対数平均輝度[Log average luminance]から計算される
    - 自動・EVZone
        - "Scene Zone"で規定されるEV値＋シーンに手動で設置されるEV"デカール"から計算される

#

# 測光単位(デバッグ)

- 仮想的な露出計[spot meter]
    - ピクセルに$cd/m^2$とEV100で絶対輝度をもたらす
    - RGBおよびsRGBの値
    - 以下のときに本当に有用である
        - emissive表面を調整するとき
        - スペキュラ反射における高い値をデバッグするとき

# 測光単位(デバッグ)

- False Colorのデバッグメニュー
    - シーンが上手く露出されるかを確認するのに有用
<!-- blank -->
- 緑　　 → middle gray (18%)
- ピンク → 肌の色合い[skin tone]
- 紫　　 → 黒潰れ[crushed blacks]
- 赤　　 → 白飛び[burnt whites]

# マテリアル較正

- ライティングに対する良いフレームワークがある
    - 現実のリファレンス
    - 一貫した値
- マテリアルは同じ処置を必要とする
- すべてのマテリアルをスキャンするのは不可能

# マテリアル較正

- いくつかのオブジェクトとマテリアルのサンプルをキャプチャする
- 制御された環境がある部屋を設定する
- 3つの白熱電球がある黒い部屋を作った
- 我々のエンジン内で再現し易い
- キャプチャされたマテリアルはライティング環境を評価するのに役立つ

# マテリアル較正

- この際に、我々は"Icing Tool"を作った
    - いくつかの較正されたライティング環境を提供する
        - あの黒い部屋を含む
        - また他には、様々なライティング環境でキャプチャされたフルレンジIBLを含む[@LAG16]
    - マテリアル特性の可視化
    - オブジェクトやマテリアルのリファレンスとの比較
- すべての小道具はこのツールで評価できる

#

# マテリアル較正(デバッグ)

- 逸脱したマテリアル特性を持つ値を強調する
    - 赤: 誤った基本色[base color]
        - 誘電体的なマテリアルはsRGBで30から240の範囲内になければならない
        - 金属的なマテリアルはsRGBで186から255の範囲内になければならない
    - 青: 誤ったガラスシェーダ反射
        - Fresnel反射率はsRGBで52から114の範囲内になければならない
    - 黄: 誤った金属感[Metallic]パラメータ
        - 金属感の値は0または1の近くにあるべきであり、中間的な値はしばしばエラーとなる

# 較正

- マテリアル特性エラー

# お品書き

- Quantic DreamでのPBRへの道のり
    - Heavy RainからDetroit: Become Humanへ
    - 測光[photometric]の単位
    - マテリアルの較正
- 直接ライティング
    - 解析的なライト
    - シャドウ
    - ボリューメトリックライティング
- 間接ライティング

# 直接ライティング

TODO

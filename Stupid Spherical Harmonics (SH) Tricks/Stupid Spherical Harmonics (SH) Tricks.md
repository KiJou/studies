---
title: Stupid Spherical Harmonics (SH) Tricks [@Sloan2008]
numberSections: false
---
# Stupid Spherical Harmonics (SH) Tricks

## 要約

この論文は同名のGDC 2008の講義の手引である。これは、球面調和関数(SH)[Spherical Harmonics]の簡潔な概要を提供し、インタラクティブグラフィクスにおいて使用可能ないくつかの方法と発生するかもしれない問題を議論する。特に、「SHを用いて効率的にライティングモデルを評価する方法」、「"リンギング[ringing]"とは何か、そして、それについてできることは何か」、「SH積の効率的な評価とそれが使われる所」、といった問題に焦点を当てる。最新バージョンは[http://www.ppsloan.org/publications](http://www.ppsloan.org/publications)で入手できる。

## はじめに

ラプラス方程式[Laplace's equation][@2]の解である調和関数[harmonic functions]は様々な分野で広く用いられる。球面調和関数は球に制限したときの解である^[これらは球座標における解の角度部分である。]。これは物理学において熱方程式[heat equation] (時間上の温度変化のモデル化[@5; @25])、重力場や電場[@9]のようなポテンシャルの問題を解くために使われてきた。量子化学や量子力学では原子の電子配置[electron configuration]や量子角運動量[quantum angular momentum]をモデル化するためにも用いられてきた[@16; @51]。グラフィクスに近い所では、散乱現象をモデル化するために使われてきた。コンピュータグラフィックスにおいて、これは広く使われてきた。初期には、ボリューメトリック散乱効果[@18]、大局的な影を持たないマイクロファセットBRDFのための環境反射[@6]、拡散でないオフライン光輸送シミュレーション[@40]、BRDF表現[@53]、画像の再ライティング[@28]、制御可能なライティングを伴う画像ベースレンダリング[@54; @55]、光源発光のモデル化[@8]、といった所で使われた。時代が下ると、異方性散乱[@50]やコンピュータビジョン[@3]における研究が増えてくる。

本論の中心はインタラクティブグラフィクスに関連する技術にある。ゲームにおいて広く使われてきた最初の論文は効率的に球面調和関数を用いて放射照度環境マップを表現することで対処する[@35]ものであり、遠方の照明の下にある拡散オブジェクトのインタラクティブレンダリングを可能にする。これは同じ制約を持つ制限されたBRDFの種類を扱うために拡張された[@36]。Precomputed Radiance Transfer(PRT)[@41 @20; @24]はライティング環境への静的なオブジェクトやシーンの反応をモデル化するものであり、しばしばSHを用いて表現され、ソフトシャドウや拡散と単純な艶やかな[glossy]マテリアルとの相互反射のような複雑な大域照明効果を含む。これは、より一般的なBRDFモデルを扱うため[@20; @23; @42]、表面下散乱を組み込むため[@42]、機械学習による圧縮技術を通じてレンダリング効率を大幅に改善するため[@42]、表面の詳細のような"局所的"なテクスチャをモデル化する様々な技術を扱うため[@43; @44; @45]に拡張された。SHは遠方のライティング環境による単一散乱をモデル化するために使われてきた[@49]。他には、遠方のライティング仮定を持ち上げる[lift]ために勾配を用いるとき[@1]、相互反射のサポート[@46; @33]を含めた動的オブジェクトに対処するいくつかの技術において[@56; @37]、一般的なBRDFモデルを持つオブジェクトのシャドウイングをモデル化するための可視性の表現として[@12]、変形可能なオブジェクトからの影をモデル化するためにスケーリング操作を用いるとき[@52]、屈折のパラメータ化として[@11]、法線マップによるLevel of Detailの問題に対処するための技術として[@15]用いられる。

より実践的な論文には、PRTの実装の詳細をカバーするもの[@13]、エンジンにこれらの技術を統合する方法[@30]、放射照度ボリュームに対してSHと勾配を使う方法[@31; @32]、投影に関する実践的な問題とSH係数を効率的に量子化する方法[@21]、解析的なスカイライトモデル[@34]をSHに投影して、モデルのパラメータの関数としてSHライトプロブを評価するために大局的多項式フィッティング[global polynomial fit]を用いる良い論文[@14]が含まれる。また、SHを用いて半球上に定義されるよりロバストな投影関数の計算技術[numerical techniques]も調査されてきた[@22]。

リアルタイムグラフィクスでの多くは、可視性、ライティング、反射率として、単に球面関数を表現する便利な方法として用いられる。他に、ウェーブレット[@39]、キューブマップ上のウェーブレット[@27]、球面放射基底関数[spherical radial basis functions][@9]、など[@26]の使用可能な基底関数が多く存在するが、球面調和関数はこの文書で述べられるであろういくつかの素晴らしい特性を持つ。これらのその他の基底関数がより適切となるシナリオが存在することを強調することは重要である。

球面調和関数は幾分手強そうに見えるかもしれないが、実のところ素直である。これは単位円上のFourier基底に類似した球上のソレであり、数値的に評価し易い。信号処理において用いられるFourier基底のように、発生し得る"リンギング"アーティファクトを最小限にするため、(ビデオゲームでは常に行われるであろう)級数の打ち切りを行うときには気を付けなければならない。本論は、球面調和関数を用いて効率的に光を評価および表現する方法、SH表現から従来の光を取り出す方法、"リンギング"の説明とその影響を最小限にする軽減技術、球面調和関数を用いる関数の積の調査を述べる。そこで述べられるのは、これが有用である点と、最適化する価値がある特殊ケースについてである。

## 背景

### 定義

球面調和関数は球$S$上の正規直交^[正規直交基底は、$\int f_i f_j = \delta_{ij}$が$i = j$のとき$1$、それ以外のとき$0$となる特性を持つものである。]基底を定義する。用いるパラメータは以下となる。

$$
s = (x, y, z) = (\sin\theta\cos\varphi, \sin\theta\sin\varphi, \cos\theta)
$$

ここで、$s$は単純に単位球上の位置[locations]である。この基底関数は以下のように定義される。

$$
Y_l^m(\theta, \varphi) = K_l^m e^{im\varphi} P_l^{|m|}(\cos\theta), l \in \boldsymbol{N}, -l \le m \le l
$$

ここで、$P_l^m$はLegendre陪多項式[associated Legendre polynomials]であり、$K_l^m$は以下の正規化定数である。

$$
K_l^m = \sqrt{\frac{(2l + 1)(l - |m|)!}{4\pi(l + |m|)!}}
$$

上記の定義は(グラフィクスでない界隈で最も一般的に使われる)複素形式によるものであり、実数値基底[real valued basis]は以下の変換によって求められる。

$$
y_l^m = \left\{ \begin{array}{c}
    \sqrt{2}\text{Re}(Y_l^m) & m > 0 \\
    \sqrt{2}\text{Im}(Y_l^m) & m < 0 \\
    Y_l^0 & m = 0
\end{array} \right. = \left\{ \begin{array}{c}
    \sqrt{2}K_l^m \cos m\varphi P_l^m(\cos\theta) & m > 0 \\
    \sqrt{2}K_l^m \sin |m|\varphi P_l^{|m|}(\cos\theta) & m < 0 \\
    K_l^0 P_l^0(\cos\theta) & m = 0
\end{array} \right.
$$

インデックス$l$は"バンド[band]"を表現する。各バンドは多項式の次数[degree]と等価であり(すなわち、0は単なる定数関数、1は線形、など)、与えられたバンドには$2l+1$個の関数が存在する。球座標は積分を計算するときに便利であるが、これらを評価するときに一般的に行われるように、多項式を用いて表現することもできる(詳細は[@sec:A1]と[@sec:A2]を参照)。位数[order]$n$のSH展開は次数$n-1$までのすべての基底関数を用いる。

TODO

# A1 {id="sec:A1"}

# A2 {id="sec:A2"}
